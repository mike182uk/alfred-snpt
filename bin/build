#!/usr/bin/env bash

echo "Checking dependencies..."

NODE_BIN=$(which node)
FZF_BIN=$(which fzf)
SNPT_BIN=$(which snpt)

if [ -z "$NODE_BIN" ]; then
  echo "node was not found" && exit 1
fi

if [ -z "$FZF_BIN" ]; then
  echo "fzf was not found" && exit 1
fi

if [ -z "$SNPT_BIN" ]; then
  echo "snpt was not found" && exit 1
fi

echo "Copying files..."

rm -rf build
mkdir build
cp -r {info.plist,node_modules,index.js,icon.png} build

echo "Updating workflow scripts..."

sed -i '' 's|{node_bin}|'$NODE_BIN'|g' build/info.plist
sed -i '' 's|{fzf_bin}|'$FZF_BIN'|g' build/info.plist
sed -i '' 's|{snpt_bin}|'$SNPT_BIN'|g' build/info.plist

echo "Building workflow..."

rm -rf Snpt.alfredworkflow
cd build && zip -rq ../Snpt.alfredworkflow *

echo "Done!"
